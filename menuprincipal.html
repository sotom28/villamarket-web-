<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Menú Principal - Villa Markets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="img/logo.png" type="image/png">
    <style>
        .text-green {
            color: #2d8f3c;
        }
        .bg-green {
            background-color: #2d8f3c;
            color: white;
        }
        .btn-green {
            background-color: #2d8f3c;
            color: white;
        }
        .btn-green:hover {
            background-color: #1a5e24;
            color: white;
        }
        .profile-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 25px;
        }
        .admin-badge {
            background-color: #ff9800;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 8px;
        }
        .profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #2d8f3c;
            margin-bottom: 15px;
        }
        .card-stat {
            transition: all 0.3s ease;
        }
        .card-stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .tab-content {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        .notification-badge {
            position: absolute;
            top: 0px;
            right: 5px;
            font-size: 0.7rem;
        }
    </style>
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="home.html">
                <img src="img/logo.png" alt="Villa Markets" width="40" height="40" class="rounded">
                Villa Markets
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" id="menu-opciones">
                    <!-- Opciones dinámicas se llenarán con JavaScript -->
                </ul>
                <button class="btn btn-outline-danger ms-2" onclick="cerrarSesion()">Cerrar Sesión</button>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <div id="bienvenida" class="mb-4">
                    <!-- Se llena con JS -->
                </div>
            </div>
        </div>
        
        <!-- Tabs para navegación en el perfil -->
        <ul class="nav nav-tabs" id="perfilTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" 
                    role="tab" aria-controls="dashboard" aria-selected="true">
                    <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="perfil-tab" data-bs-toggle="tab" data-bs-target="#perfil" type="button" 
                    role="tab" aria-controls="perfil" aria-selected="false">
                    <i class="fas fa-user me-1"></i> Mi Perfil
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pedidos-tab" data-bs-toggle="tab" data-bs-target="#pedidos" type="button" 
                    role="tab" aria-controls="pedidos" aria-selected="false">
                    <i class="fas fa-box me-1"></i> Pedidos
                </button>
            </li>
            <li class="nav-item d-none" id="admin-tab-item" role="presentation">
                <button class="nav-link" id="admin-tab" data-bs-toggle="tab" data-bs-target="#admin" type="button" 
                    role="tab" aria-controls="admin" aria-selected="false">
                    <i class="fas fa-lock me-1"></i> Administración
                    <span class="badge bg-danger notification-badge">3</span>
                </button>
            </li>
        </ul>
        
        <div class="tab-content bg-white" id="perfilTabsContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                <div class="row">
                    <!-- Panel de Control -->
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-green">
                                <h5 class="card-title mb-0 text-white" id="panel-control-title">Panel de Control</h5>
                            </div>
                            <div class="card-body" id="panel-control">
                                <!-- Se llena dinámicamente según el rol -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Actividad Reciente -->
                    <div class="col-md-8">
                        <div class="card h-100">
                            <div class="card-header bg-green">
                                <h5 class="card-title mb-0 text-white">Actividad Reciente</h5>
                            </div>
                            <div class="card-body" id="actividad-reciente">
                                <div class="list-group list-group-flush" id="actividad-lista">
                                    <!-- Se llena dinámicamente según el rol -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Estadísticas (solo para administradores) -->
                <div class="row mt-4 d-none" id="admin-stats">
                    <div class="col-md-12">
                        <h4 class="mb-3">Estadísticas Generales</h4>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card card-stat text-center bg-light">
                            <div class="card-body">
                                <i class="fas fa-users fa-2x text-green mb-2"></i>
                                <h5 class="card-title">Usuarios</h5>
                                <p class="card-text display-6 fw-bold">142</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +12% este mes</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card card-stat text-center bg-light">
                            <div class="card-body">
                                <i class="fas fa-shopping-cart fa-2x text-green mb-2"></i>
                                <h5 class="card-title">Ventas</h5>
                                <p class="card-text display-6 fw-bold">286</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +8% este mes</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card card-stat text-center bg-light">
                            <div class="card-body">
                                <i class="fas fa-dollar-sign fa-2x text-green mb-2"></i>
                                <h5 class="card-title">Ingresos</h5>
                                <p class="card-text display-6 fw-bold">$4.3M</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +15% este mes</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card card-stat text-center bg-light">
                            <div class="card-body">
                                <i class="fas fa-store fa-2x text-green mb-2"></i>
                                <h5 class="card-title">Minimarkets</h5>
                                <p class="card-text display-6 fw-bold">12</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +2 este mes</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Perfil Tab -->
            <div class="tab-pane fade" id="perfil" role="tabpanel" aria-labelledby="perfil-tab">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <div id="profile-image-container" class="mb-3">
                            <!-- Se llena con JS -->
                        </div>
                        <button class="btn btn-outline-secondary btn-sm mb-3" onclick="cambiarFoto()">
                            <i class="fas fa-camera me-1"></i> Cambiar foto
                        </button>
                    </div>
                    
                    <div class="col-md-9">
                        <form id="form-perfil">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="nombre" name="nombre">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="apellidos" class="form-label">Apellidos</label>
                                    <input type="text" class="form-control" id="apellidos" name="apellidos">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="correo" class="form-label">Correo electrónico</label>
                                    <input type="email" class="form-control" id="correo" name="correo">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="telefono" class="form-label">Teléfono</label>
                                    <input type="tel" class="form-control" id="telefono" name="telefono">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="direccion" class="form-label">Dirección</label>
                                <input type="text" class="form-control" id="direccion" name="direccion">
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="dieta" class="form-label">Tipo de dieta</label>
                                    <select class="form-select" id="dieta" name="dieta">
                                        <option value="Ninguna">Ninguna</option>
                                        <option value="Vegana">Vegana</option>
                                        <option value="Vegetariana">Vegetariana</option>
                                        <option value="Sin gluten">Sin gluten</option>
                                        <option value="Keto">Keto</option>
                                        <option value="Otra">Otra</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3" id="container-rol">
                                    <label for="rol" class="form-label">Rol de Usuario</label>
                                    <input type="text" class="form-control" id="rol" name="rol" readonly>
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            <h5 class="mb-3">Cambiar contraseña</h5>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="password-actual" class="form-label">Contraseña actual</label>
                                    <input type="password" class="form-control" id="password-actual">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="password-nuevo" class="form-label">Nueva contraseña</label>
                                    <input type="password" class="form-control" id="password-nuevo">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="password-confirmar" class="form-label">Confirmar contraseña</label>
                                    <input type="password" class="form-control" id="password-confirmar">
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                <button type="button" class="btn btn-outline-secondary me-md-2" onclick="cancelarEdicion()">Cancelar</button>
                                <button type="button" class="btn btn-green" onclick="guardarPerfil()">Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Pedidos Tab -->
            <div class="tab-pane fade" id="pedidos" role="tabpanel" aria-labelledby="pedidos-tab">
                <h4 class="mb-4">Mis Pedidos</h4>
                
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Total</th>
                                <th>Minimarket</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-pedidos">
                            <!-- Se llena dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Admin Tab (Solo para administradores) -->
            <div class="tab-pane fade" id="admin" role="tabpanel" aria-labelledby="admin-tab">
                <h4 class="mb-4">Panel de Administración</h4>
                
                <!-- Pestañas secundarias para secciones de administración -->
                <ul class="nav nav-pills mb-3" id="adminSubTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="usuarios-tab" data-bs-toggle="pill" data-bs-target="#usuarios" type="button">Usuarios</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="productos-tab" data-bs-toggle="pill" data-bs-target="#productos-admin" type="button">Productos</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tiendas-tab" data-bs-toggle="pill" data-bs-target="#tiendas" type="button">Minimarkets</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="ventas-tab" data-bs-toggle="pill" data-bs-target="#ventas" type="button">Ventas</button>
                    </li>
                </ul>
                
                <div class="tab-content mt-3" id="adminSubTabsContent">
                    <!-- Gestión de Usuarios -->
                    <div class="tab-pane fade show active" id="usuarios" role="tabpanel" aria-labelledby="usuarios-tab">
                        <div class="d-flex justify-content-between mb-3">
                            <h5>Lista de Usuarios</h5>
                            <button class="btn btn-green btn-sm" onclick="abrirModalNuevoUsuario()">
                                <i class="fas fa-plus me-1"></i> Nuevo Usuario
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Rol</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-usuarios">
                                    <!-- Se llena dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Gestión de Productos -->
                    <div class="tab-pane fade" id="productos-admin" role="tabpanel" aria-labelledby="productos-tab">
                        <div class="d-flex justify-content-between mb-3">
                            <h5>Inventario de Productos</h5>
                            <button class="btn btn-green btn-sm" onclick="abrirModalNuevoProducto()">
                                <i class="fas fa-plus me-1"></i> Nuevo Producto
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Producto</th>
                                        <th>Categoría</th>
                                        <th>Precio</th>
                                        <th>Stock</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-productos">
                                    <!-- Se llena dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Gestión de Minimarkets -->
                    <div class="tab-pane fade" id="tiendas" role="tabpanel" aria-labelledby="tiendas-tab">
                        <div class="d-flex justify-content-between mb-3">
                            <h5>Gestión de Minimarkets</h5>
                            <button class="btn btn-green btn-sm" onclick="abrirModalNuevoMinimarket()">
                                <i class="fas fa-plus me-1"></i> Nuevo Minimarket
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Dirección</th>
                                        <th>Comuna</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-minimarkets">
                                    <!-- Se llena dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Reportes de Ventas -->
                    <div class="tab-pane fade" id="ventas" role="tabpanel" aria-labelledby="ventas-tab">
                        <h5>Reporte de Ventas</h5>
                        
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card text-center bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title">Ventas del día</h5>
                                        <p class="card-text display-6 fw-bold">$540.000</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title">Ventas del mes</h5>
                                        <p class="card-text display-6 fw-bold">$4.3M</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title">Pedidos hoy</h5>
                                        <p class="card-text display-6 fw-bold">24</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title">Pedidos mes</h5>
                                        <p class="card-text display-6 fw-bold">286</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID Venta</th>
                                        <th>Cliente</th>
                                        <th>Fecha</th>
                                        <th>Minimarket</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-ventas">
                                    <!-- Se llena dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Usuario (Admin) -->
    <div class="modal fade" id="modalNuevoUsuario" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-green text-white">
                    <h5 class="modal-title">Nuevo Usuario</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formNuevoUsuario">
                        <div class="mb-3">
                            <label for="nuevoNombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nuevoNombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="nuevoApellidos" class="form-label">Apellidos</label>
                            <input type="text" class="form-control" id="nuevoApellidos" required>
                        </div>
                        <div class="mb-3">
                            <label for="nuevoEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="nuevoEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="nuevoPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="nuevoPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="nuevoRol" class="form-label">Rol</label>
                            <select class="form-select" id="nuevoRol" required>
                                <option value="cliente">Cliente</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-green" onclick="guardarNuevoUsuario()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Producto (Admin) -->
    <div class="modal fade" id="modalNuevoProducto" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-green text-white">
                    <h5 class="modal-title">Nuevo Producto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formNuevoProducto">
                        <div class="mb-3">
                            <label for="productoNombre" class="form-label">Nombre del Producto</label>
                            <input type="text" class="form-control" id="productoNombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="productoCategoria" class="form-label">Categoría</label>
                            <select class="form-select" id="productoCategoria">
                                <option value="Frutas y Verduras">Frutas y Verduras</option>
                                <option value="Lácteos">Lácteos</option>
                                <option value="Carnes">Carnes</option>
                                <option value="Panadería">Panadería</option>
                                <option value="Bebidas">Bebidas</option>
                                <option value="Limpieza">Limpieza</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="productoPrecio" class="form-label">Precio</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="productoPrecio" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="productoStock" class="form-label">Stock</label>
                            <input type="number" class="form-control" id="productoStock" required>
                        </div>
                        <div class="mb-3">
                            <label for="productoImagen" class="form-label">URL de la imagen</label>
                            <input type="text" class="form-control" id="productoImagen">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-green" onclick="guardarNuevoProducto()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Minimarket (Admin) -->
    <div class="modal fade" id="modalNuevoMinimarket" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-green text-white">
                    <h5 class="modal-title">Nuevo Minimarket</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formNuevoMinimarket">
                        <div class="mb-3">
                            <label for="minimarketNombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="minimarketNombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="minimarketDireccion" class="form-label">Dirección</label>
                            <input type="text" class="form-control" id="minimarketDireccion" required>
                        </div>
                        <div class="mb-3">
                            <label for="minimarketComuna" class="form-label">Comuna</label>
                            <input type="text" class="form-control" id="minimarketComuna" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="minimarketLat" class="form-label">Latitud</label>
                                <input type="text" class="form-control" id="minimarketLat" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="minimarketLng" class="form-label">Longitud</label>
                                <input type="text" class="form-control" id="minimarketLng" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="minimarketHorario" class="form-label">Horario</label>
                            <input type="text" class="form-control" id="minimarketHorario" placeholder="Ej: Lun-Vie: 8:00-21:00, Sáb-Dom: 9:00-20:00" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-green" onclick="guardarNuevoMinimarket()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Villa Markets</h5>
                    <p>Tu plataforma para mini markets locales en todo Chile.</p>
                </div>
                <div class="col-md-4">
                    <h5>Enlaces rápidos</h5>
                    <ul class="list-unstyled">
                        <li><a href="minimarkets.html" class="text-white">Minimarkets</a></li>
                        <li><a href="productos.html" class="text-white">Catálogo</a></li>
                        <li><a href="soporte.html" class="text-white">Soporte</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contáctanos</h5>
                    <p>contacto@villamarkets.cl</p>
                    <p>+56 9 1234 5678</p>
                </div>
            </div>
            <hr>
            <p class="text-center small mb-0">© 2025 Villa Markets. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Verificar si el usuario está logueado
        const usuarioActual = JSON.parse(localStorage.getItem('usuarioActual')) || crearUsuarioDemo();
        
        if (!usuarioActual) {
            // Si no hay usuario logueado, redirigir al login
            window.location.href = 'login.html';
            return;
        }
        
        // Actualizar menú de navegación según el rol
        actualizarMenuNavegacion(usuarioActual);
        
        // Mostrar mensaje de bienvenida
        document.getElementById('bienvenida').innerHTML = `
            <h2>Bienvenido, ${usuarioActual.nombre}</h2>
            <p>Accede a todas tus opciones desde este panel.</p>
        `;
        
        // Configurar el acceso según el rol
        if (usuarioActual.rol === 'admin') {
            // Mostrar pestaña de admin
            document.getElementById('admin-tab-item').classList.remove('d-none');
            // Mostrar estadísticas de admin
            document.getElementById('admin-stats').classList.remove('d-none');
            // Cambiar el título del panel de control
            document.getElementById('panel-control-title').innerText = 'Panel de Administrador';
        }
        
        // Configurar el panel de control según el rol
        configurarPanelControl(usuarioActual);
        
        // Cargar actividades recientes
        cargarActividadReciente(usuarioActual);
        
        // Cargar datos de perfil
        cargarDatosPerfil(usuarioActual);
        
        // Cargar pedidos
        cargarPedidos(usuarioActual);
        
        // Si es admin, cargar datos de administración
        if (usuarioActual.rol === 'admin') {
            cargarDatosAdmin();
        }
    });
    
    // Función para crear un usuario demo si no existe ninguno
    function crearUsuarioDemo() {
        // Crear un usuario demo para pruebas
        const usuarioDemo = {
            nombre: 'Usuario',
            apellidos: 'Demo',
            email: 'demo@villamarkets.cl',
            password: 'demo1234',
            rol: 'cliente', // Cambia a 'admin' para probar como administrador
            telefono: '+56912345678',
            direccion: 'Av. Ejemplo 123, Santiago',
            dieta: 'Ninguna'
        };
        
        localStorage.setItem('usuarioActual', JSON.stringify(usuarioDemo));
        return usuarioDemo;
    }
    
    // Función para actualizar el menú de navegación
    function actualizarMenuNavegacion(usuario) {
        const menuOpciones = document.getElementById('menu-opciones');
        
        // Opciones comunes para todos los usuarios
        menuOpciones.innerHTML = `
            <li class="nav-item"><a class="nav-link" href="home.html">Inicio</a></li>
            <li class="nav-item"><a class="nav-link" href="productos.html">Productos</a></li>
            <li class="nav-item"><a class="nav-link" href="minimarkets.html">Minimarkets</a></li>
            <li class="nav-item"><a class="nav-link" href="carrito.html">
                <i class="fas fa-shopping-cart"></i> Carrito
                <span class="badge bg-danger rounded-pill">3</span>
            </a></li>
        `;
        
        // Si es admin, agregar opciones de administración
        if (usuario.rol === 'admin') {
            menuOpciones.innerHTML += `
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" 
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-cog"></i> Administración
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                        <li><a class="dropdown-item" href="#" onclick="mostrarTab('admin', 'usuarios')">Usuarios</a></li>
                        <li><a class="dropdown-item" href="#" onclick="mostrarTab('admin', 'productos-admin')">Productos</a></li>
                        <li><a class="dropdown-item" href="#" onclick="mostrarTab('admin', 'tiendas')">Minimarkets</a></li>
                        <li><a class="dropdown-item" href="#" onclick="mostrarTab('admin', 'ventas')">Ventas</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Configuración</a></li>
                    </ul>
                </li>
            `;
        }
    }
    
    // Función para configurar el panel de control
    function configurarPanelControl(usuario) {
        const panelControl = document.getElementById('panel-control');
        
        if (usuario.rol === 'admin') {
            // Opciones para administrador
            panelControl.innerHTML = `
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-users text-green me-3"></i>
                        <a href="#" class="text-decoration-none flex-grow-1" onclick="mostrarTab('admin', 'usuarios')">Gestión de Usuarios</a>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-box text-green me-3"></i>
                        <a href="#" class="text-decoration-none flex-grow-1" onclick="mostrarTab('admin', 'productos-admin')">Gestión de Productos</a>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-store text-green me-3"></i>
                        <a href="#" class="text-decoration-none flex-grow-1" onclick="mostrarTab('admin', 'tiendas')">Gestión de Minimarkets</a>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-chart-line text-green me-3"></i>
                        <a href="#" class="text-decoration-none flex-grow-1" onclick="mostrarTab('admin', 'ventas')">Reportes de Ventas</a>
                        <span class="badge bg-success rounded-pill">Nuevo</span>
                    </li>
                </ul>
            `;
        } else {
            // Opciones para cliente
            panelControl.innerHTML = `
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-shopping-basket text-green me-3"></i>
                        <a href="productos.html" class="text-decoration-none flex-grow-1">Ver Productos</a>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-shopping-cart text-green me-3"></i>
                        <a href="carrito.html" class="text-decoration-none flex-grow-1">Mi Carrito</a>
                        <span class="badge bg-success rounded-pill">3</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-history text-green me-3"></i>
                        <a href="#" class="text-decoration-none flex-grow-1" onclick="mostrarTab('pedidos')">Mis Pedidos</a>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-map-marker-alt text-green me-3"></i>
                        <a href="minimarkets.html" class="text-decoration-none flex-grow-1">Buscar Minimarkets</a>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-user text-green me-3"></i>
                        <a href="#" class="text-decoration-none flex-grow-1" onclick="mostrarTab('perfil')">Mi Perfil</a>
                    </li>
                </ul>
            `;
        }
    }
    
    // Función para cargar actividad reciente
    function cargarActividadReciente(usuario) {
        const actividadLista = document.getElementById('actividad-lista');
        
        if (usuario.rol === 'admin') {
            // Actividad para administrador
            actividadLista.innerHTML = `
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Nueva venta registrada</h6>
                        <small class="text-muted">hace 5 minutos</small>
                    </div>
                    <p class="mb-1">Venta #1458 por $24,500 en Minimarket Villa Central</p>
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Usuario nuevo registrado</h6>
                        <small class="text-muted">hace 1 hora</small>
                    </div>
                    <p class="mb-1">Ana Muñoz se ha registrado como cliente</p>
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Producto con poco stock</h6>
                        <small class="text-muted">hace 3 horas</small>
                    </div>
                    <p class="mb-1">Leche Deslactosada (ID: 245) - Quedan 5 unidades</p>
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Actualización del sistema</h6>
                        <small class="text-muted">hace 1 día</small>
                    </div>
                    <p class="mb-1">Se ha actualizado el módulo de inventario</p>
                </a>
            `;
        } else {
            // Actividad para cliente
            actividadLista.innerHTML = `
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Pedido entregado</h6>
                        <small class="text-muted">hace 2 días</small>
                    </div>
                    <p class="mb-1">Tu pedido #125 ha sido entregado correctamente</p>
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Nuevo descuento disponible</h6>
                        <small class="text-muted">hace 3 días</small>
                    </div>
                    <p class="mb-1">15% de descuento en lácteos este fin de semana</p>
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Tu pedido está en camino</h6>
                        <small class="text-muted">hace 5 días</small>
                    </div>
                    <p class="mb-1">Tu pedido #124 está en proceso de entrega</p>
                </a>
            `;
        }
    }
    
    // Función para cargar datos de perfil
    function cargarDatosPerfil(usuario) {
        // Establecer foto de perfil
        document.getElementById('profile-image-container').innerHTML = `
            <div class="position-relative">
                <img src="https://via.placeholder.com/150" class="rounded-circle profile-picture" alt="Foto de perfil">
                ${usuario.rol === 'admin' ? '<span class="position-absolute bottom-0 end-0 admin-badge"><i class="fas fa-star"></i></span>' : ''}
            </div>
        `;
        
        // Establecer valores en el formulario de perfil
        document.getElementById('nombre').value = usuario.nombre || '';
        document.getElementById('apellidos').value = usuario.apellidos || '';
        document.getElementById('correo').value = usuario.email || '';
        document.getElementById('telefono').value = usuario.telefono || '';
        document.getElementById('direccion').value = usuario.direccion || '';
        document.getElementById('dieta').value = usuario.dieta || 'Ninguna';
        
        // Mostrar el rol
        const rolInput = document.getElementById('rol');
        rolInput.value = usuario.rol === 'admin' ? 'Administrador' : 'Cliente';
        
        // Estilo especial para admin
        if (usuario.rol === 'admin') {
            const rolContainer = document.getElementById('container-rol');
            rolContainer.innerHTML = `
                <label for="rol" class="form-label">Rol de Usuario</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="rol" value="Administrador" readonly>
                    <span class="input-group-text bg-danger text-white"><i class="fas fa-shield-alt"></i></span>
                </div>
            `;
        }
    }
    
    // Función para cargar pedidos
    function cargarPedidos(usuario) {
        const tablaPedidos = document.getElementById('tabla-pedidos');
        
        // Obtener pedidos guardados en localStorage
        const pedidosGuardados = JSON.parse(localStorage.getItem('pedidosVillaMarkets')) || [];
        
        // Si no hay pedidos guardados, usar datos de ejemplo
        let pedidos = pedidosGuardados.length > 0 ? pedidosGuardados : [
            { id: 'P-12587', fecha: '15/06/2023', estado: 'Entregado', totales: { total: 34500 }, minimarket: 'M001' },
            { id: 'P-12586', fecha: '10/06/2023', estado: 'En proceso', totales: { total: 12750 }, minimarket: 'M002' },
            { id: 'P-12573', fecha: '02/06/2023', estado: 'Entregado', totales: { total: 8900 }, minimarket: 'M003' },
            { id: 'P-12565', fecha: '28/05/2023', estado: 'Cancelado', totales: { total: 15200 }, minimarket: 'M001' }
        ];
        
        // Filtrar pedidos si es cliente (solo mostrar los suyos)
        if (usuario.rol !== 'admin' && usuario.email) {
            pedidos = pedidos.filter(pedido => 
                pedido.cliente && pedido.cliente.email === usuario.email
            );
        }
        
        // Generar HTML de filas
        let html = '';
        
        if (pedidos.length === 0) {
            tablaPedidos.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <div class="text-muted">
                            <i class="fas fa-box-open fa-2x mb-3"></i>
                            <h6>No hay pedidos disponibles</h6>
                            <p class="small">¡Realiza tu primer pedido en nuestra tienda!</p>
                            <a href="productos.html" class="btn btn-sm btn-green mt-2">Ver productos</a>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }
        
        // Ordenar pedidos por fecha (más recientes primero)
        pedidos.sort((a, b) => new Date(b.fechaCreacion || b.fecha) - new Date(a.fechaCreacion || a.fecha));
        
        pedidos.forEach(pedido => {
            let estadoClass = '';
            
            switch(pedido.estado) {
                case 'Entregado':
                    estadoClass = 'bg-success';
                    break;
                case 'En proceso':
                case 'Pendiente':
                    estadoClass = 'bg-warning';
                    break;
                case 'Cancelado':
                    estadoClass = 'bg-danger';
                    break;
                default:
                    estadoClass = 'bg-info';
                    break;
            }
            
            // Formatear total
            const total = typeof pedido.totales?.total === 'number' 
                ? `$${pedido.totales.total.toLocaleString('es-CL')}` 
                : pedido.total || '$0';
            
            // Determinar nombre del minimarket
            let nombreMinimarket = pedido.minimarket;
            if (pedido.minimarket === 'M001') nombreMinimarket = 'Villa Central';
            else if (pedido.minimarket === 'M002') nombreMinimarket = 'Villa Norte';
            else if (pedido.minimarket === 'M003') nombreMinimarket = 'Villa Sur';
            else if (pedido.minimarket === 'M004') nombreMinimarket = 'Villa Este';
            
            html += `
                <tr>
                    <td>${pedido.id}</td>
                    <td>${pedido.fecha}</td>
                    <td><span class="badge ${estadoClass}">${pedido.estado}</span></td>
                    <td>${total}</td>
                    <td>${nombreMinimarket}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-dark" onclick="verDetallePedido('${pedido.id}')">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        ${(pedido.estado === 'En proceso' || pedido.estado === 'Pendiente') ? 
                            `<button class="btn btn-sm btn-outline-danger ms-1" onclick="cancelarPedido('${pedido.id}')">
                                <i class="fas fa-times"></i> Cancelar
                            </button>` : ''}
                    </td>
                </tr>
            `;
        });
        
        tablaPedidos.innerHTML = html;
    }
    
    // Función para ver detalle de pedido
    function verDetallePedido(id) {
        // Obtener pedidos guardados
        const pedidos = JSON.parse(localStorage.getItem('pedidosVillaMarkets')) || [];
        const pedido = pedidos.find(p => p.id === id);
        
        if (!pedido) {
            alert(`No se encontró el pedido ${id}`);
            return;
        }
        
        // Formatear total
        const total = typeof pedido.totales?.total === 'number' 
            ? `$${pedido.totales.total.toLocaleString('es-CL')}` 
            : pedido.total || '$0';
        
        // Determinar nombre del minimarket
        let nombreMinimarket = pedido.minimarket;
        if (pedido.minimarket === 'M001') nombreMinimarket = 'Villa Central';
        else if (pedido.minimarket === 'M002') nombreMinimarket = 'Villa Norte';
        else if (pedido.minimarket === 'M003') nombreMinimarket = 'Villa Sur';
        else if (pedido.minimarket === 'M004') nombreMinimarket = 'Villa Este';
        
        // Crear HTML para los items del pedido
        let itemsHtml = '';
        if (pedido.items && pedido.items.length > 0) {
            itemsHtml = '<div class="mt-3"><h6>Productos:</h6><ul class="list-group list-group-flush">';
            pedido.items.forEach(item => {
                itemsHtml += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <span>${item.nombre}</span>
                            <span class="badge bg-secondary ms-2">${item.cantidad}x</span>
                        </div>
                        <span>$${(item.precio * item.cantidad).toLocaleString('es-CL')}</span>
                    </li>
                `;
            });
            itemsHtml += '</ul></div>';
        }
        
        // Crear HTML para la dirección de entrega (si es delivery)
        let direccionHtml = '';
        if (pedido.tipoEntrega === 'delivery' && pedido.direccionEntrega) {
            const dir = pedido.direccionEntrega;
            direccionHtml = `
                <div class="mt-3">
                    <h6>Dirección de entrega:</h6>
                    <p class="mb-0">${dir.calle} ${dir.numero}${dir.depto ? ', ' + dir.depto : ''}</p>
                    <p>${dir.comuna}</p>
                </div>
            `;
        }
        
        Swal.fire({
            title: `Pedido #${pedido.id}`,
            html: `
                <div class="text-start">
                    <div class="d-flex justify-content-between">
                        <strong>Fecha:</strong>
                        <span>${pedido.fecha} ${pedido.hora || ''}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <strong>Estado:</strong>
                        <span class="badge ${
                            pedido.estado === 'Entregado' ? 'bg-success' : 
                            pedido.estado === 'Cancelado' ? 'bg-danger' : 'bg-warning'
                        }">${pedido.estado}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <strong>Total:</strong>
                        <span>${total}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <strong>Método de entrega:</strong>
                        <span>${pedido.tipoEntrega === 'recoger' ? 'Recoger en tienda' : 'Delivery'}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <strong>Minimarket:</strong>
                        <span>${nombreMinimarket}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <strong>Método de pago:</strong>
                        <span>${
                            pedido.metodoPago === 'efectivo' ? 'Efectivo' : 
                            pedido.metodoPago === 'tarjeta' ? 'Tarjeta' : 'Transferencia'
                        }</span>
                    </div>
                    ${itemsHtml}
                    ${direccionHtml}
                    ${pedido.notas ? `<div class="mt-3"><h6>Notas:</h6><p>${pedido.notas}</p></div>` : ''}
                </div>
            `,
            confirmButtonText: 'Cerrar',
            confirmButtonColor: '#2d8f3c',
            width: '600px'
        });
    }
    
    // Función para cancelar pedido
    function cancelarPedido(id) {
        Swal.fire({
            title: '¿Cancelar pedido?',
            text: `¿Estás seguro de que deseas cancelar el pedido ${id}?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Sí, cancelar',
            cancelButtonText: 'No, mantener'
        }).then((result) => {
            if (result.isConfirmed) {
                // Obtener pedidos guardados
                const pedidos = JSON.parse(localStorage.getItem('pedidosVillaMarkets')) || [];
                
                // Buscar el pedido y cambiar su estado
                const pedidoIndex = pedidos.findIndex(p => p.id === id);
                if (pedidoIndex >= 0) {
                    pedidos[pedidoIndex].estado = 'Cancelado';
                    // Guardar cambios
                    localStorage.setItem('pedidosVillaMarkets', JSON.stringify(pedidos));
                    
                    // Recargar la tabla de pedidos
                    cargarPedidos(JSON.parse(localStorage.getItem('usuarioActual')));
                    
                    Swal.fire(
                        '¡Cancelado!',
                        `El pedido ${id} ha sido cancelado.`,
                        'success'
                    );
                }
            }
        });
    }
    
    // Función para cargar datos de administración
    function cargarDatosAdmin() {
        // Cargar tabla de usuarios
        const tablaUsuarios = document.getElementById('tabla-usuarios');
        tablaUsuarios.innerHTML = `
            <tr>
                <td>001</td>
                <td>Juan Pérez</td>
                <td>juan@example.com</td>
                <td><span class="badge bg-danger">Admin</span></td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarUsuario('001')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('001')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>002</td>
                <td>María Gómez</td>
                <td>maria@example.com</td>
                <td><span class="badge bg-success">Cliente</span></td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarUsuario('002')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('002')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>003</td>
                <td>Carlos Ruiz</td>
                <td>carlos@example.com</td>
                <td><span class="badge bg-success">Cliente</span></td>
                <td><span class="badge bg-warning">Pendiente</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarUsuario('003')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('003')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>004</td>
                <td>Ana Muñoz</td>
                <td>ana@example.com</td>
                <td><span class="badge bg-success">Cliente</span></td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarUsuario('004')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('004')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `;
        
        // Cargar tabla de productos
        const tablaProductos = document.getElementById('tabla-productos');
        tablaProductos.innerHTML = `
            <tr>
                <td>P001</td>
                <td>Leche Deslactosada 1L</td>
                <td>Lácteos</td>
                <td>$1,200</td>
                <td><span class="badge bg-danger">5</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarProducto('P001')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarProducto('P001')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>P002</td>
                <td>Pan Integral 500g</td>
                <td>Panadería</td>
                <td>$900</td>
                <td><span class="badge bg-success">25</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarProducto('P002')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarProducto('P002')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>P003</td>
                <td>Manzanas Rojas (kg)</td>
                <td>Frutas y Verduras</td>
                <td>$1,500</td>
                <td><span class="badge bg-success">40</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarProducto('P003')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarProducto('P003')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>P004</td>
                <td>Detergente Concentrado 1L</td>
                <td>Limpieza</td>
                <td>$2,800</td>
                <td><span class="badge bg-warning">12</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarProducto('P004')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarProducto('P004')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `;
        
        // Cargar tabla de minimarkets
        const tablaMinimarkets = document.getElementById('tabla-minimarkets');
        tablaMinimarkets.innerHTML = `
            <tr>
                <td>M001</td>
                <td>Villa Central</td>
                <td>Av. Central 123</td>
                <td>Santiago</td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarMinimarket('M001')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarMinimarket('M001')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>M002</td>
                <td>Villa Norte</td>
                <td>Av. Norte 456</td>
                <td>La Reina</td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarMinimarket('M002')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarMinimarket('M002')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>M003</td>
                <td>Villa Sur</td>
                <td>Av. Sur 789</td>
                <td>La Florida</td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarMinimarket('M003')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarMinimarket('M003')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            <tr>
                <td>M004</td>
                <td>Villa Este</td>
                <td>Av. Este 321</td>
                <td>Ñuñoa</td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-dark" onclick="editarMinimarket('M004')"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarMinimarket('M004')"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `;
        
        // Cargar tabla de ventas
        const tablaVentas = document.getElementById('tabla-ventas');
        tablaVentas.innerHTML = `
            <tr>
                <td>V1458</td>
                <td>María Gómez</td>
                <td>15/06/2023</td>
                <td>Villa Central</td>
                <td>$24,500</td>
                <td><span class="badge bg-success">Completada</span></td>
            </tr>
            <tr>
                <td>V1457</td>
                <td>Carlos Ruiz</td>
                <td>15/06/2023</td>
                <td>Villa Norte</td>
                <td>$18,200</td>
                <td><span class="badge bg-success">Completada</span></td>
            </tr>
            <tr>
                <td>V1456</td>
                <td>Ana Muñoz</td>
                <td>14/06/2023</td>
                <td>Villa Este</td>
                <td>$32,800</td>
                <td><span class="badge bg-success">Completada</span></td>
            </tr>
            <tr>
                <td>V1455</td>
                <td>Pedro Silva</td>
                <td>14/06/2023</td>
                <td>Villa Sur</td>
                <td>$15,600</td>
                <td><span class="badge bg-warning">En proceso</span></td>
            </tr>
        `;
    }
    
    // Función para cambiar entre pestañas
    function mostrarTab(tabPrincipal, tabSecundaria = null) {
        // Activar la pestaña principal
        const tabTriggerEl = document.querySelector(`#${tabPrincipal}-tab`);
        bootstrap.Tab.getOrCreateInstance(tabTriggerEl).show();
        
        // Si hay pestaña secundaria, activarla
        if (tabSecundaria) {
            setTimeout(() => {
                const tabSecundariaEl = document.querySelector(`#${tabSecundaria}-tab`);
                bootstrap.Tab.getOrCreateInstance(tabSecundariaEl).show();
            }, 100);
        }
    }
    
    // Función para cerrar sesión
    function cerrarSesion() {
        localStorage.removeItem('usuarioActual');
        window.location.href = 'login.html';
    }
    
    // Función para cambiar foto de perfil (simulada)
    function cambiarFoto() {
        alert('Funcionalidad de cambio de foto en desarrollo');
    }
    
    // Función para guardar cambios en el perfil
    function guardarPerfil() {
        // Obtener datos del formulario
        const nombre = document.getElementById('nombre').value;
        const apellidos = document.getElementById('apellidos').value;
        const email = document.getElementById('correo').value;
        const telefono = document.getElementById('telefono').value;
        const direccion = document.getElementById('direccion').value;
        const dieta = document.getElementById('dieta').value;
        
        // Validar datos básicos
        if (!nombre || !email) {
            alert('Por favor, completa los campos obligatorios (nombre y correo).');
            return;
        }
        
        // Obtener usuario actual
        const usuarioActual = JSON.parse(localStorage.getItem('usuarioActual'));
        
        if (!usuarioActual) {
            alert('Error: No se pudo acceder a la información del usuario.');
            return;
        }
        
        // Actualizar datos
        usuarioActual.nombre = nombre;
        usuarioActual.apellidos = apellidos;
        usuarioActual.email = email;
        usuarioActual.telefono = telefono;
        usuarioActual.direccion = direccion;
        usuarioActual.dieta = dieta;
        
        // Verificar si se está cambiando la contraseña
        const passwordActual = document.getElementById('password-actual').value;
        const passwordNuevo = document.getElementById('password-nuevo').value;
        const passwordConfirmar = document.getElementById('password-confirmar').value;
        
        if (passwordActual && passwordNuevo && passwordConfirmar) {
            if (passwordActual !== usuarioActual.password) {
                alert('La contraseña actual no es correcta.');
                return;
            }
            
            if (passwordNuevo !== passwordConfirmar) {
                alert('Las nuevas contraseñas no coinciden.');
                return;
            }
            
            usuarioActual.password = passwordNuevo;
        }
        
        // Guardar cambios
        localStorage.setItem('usuarioActual', JSON.stringify(usuarioActual));
        
        // Actualizar bienvenida
        document.getElementById('bienvenida').innerHTML = `
            <h2>Bienvenido, ${usuarioActual.nombre}</h2>
            <p>Accede a todas tus opciones desde este panel.</p>
        `;
        
        // Mostrar mensaje
        alert('¡Perfil actualizado correctamente!');
        
        // Volver al dashboard
        mostrarTab('dashboard');
    }
    
    // Función para cancelar edición de perfil
    function cancelarEdicion() {
        // Recargar datos del perfil
        cargarDatosPerfil(JSON.parse(localStorage.getItem('usuarioActual')));
        // Volver al dashboard
        mostrarTab('dashboard');
    }
    
    // Función para ver detalle de pedido
    function verDetallePedido(id) {
        alert(`Detalles del pedido ${id} en desarrollo`);
    }
    
    // Función para cancelar pedido
    function cancelarPedido(id) {
        if (confirm(`¿Estás seguro de que deseas cancelar el pedido ${id}?`)) {
            alert(`El pedido ${id} ha sido cancelado`);
            // Recargar la página para reflejar el cambio
            location.reload();
        }
    }
    
    // Funciones de administración
    
    // Mostrar modal de nuevo usuario
    function abrirModalNuevoUsuario() {
        const modalNuevoUsuario = new bootstrap.Modal(document.getElementById('modalNuevoUsuario'));
        modalNuevoUsuario.show();
    }
    
    // Guardar nuevo usuario
    function guardarNuevoUsuario() {
        const nombre = document.getElementById('nuevoNombre').value;
        const apellidos = document.getElementById('nuevoApellidos').value;
        const email = document.getElementById('nuevoEmail').value;
        const password = document.getElementById('nuevoPassword').value;
        const rol = document.getElementById('nuevoRol').value;
        
        if (!nombre || !email || !password) {
            alert('Por favor, completa todos los campos obligatorios.');
            return;
        }
        
        // Simular guardado
        alert(`Usuario ${nombre} ${apellidos} creado correctamente.`);
        
        // Cerrar modal
        bootstrap.Modal.getInstance(document.getElementById('modalNuevoUsuario')).hide();
        
        // Añadir a la tabla (simulación)
        const tablaUsuarios = document.getElementById('tabla-usuarios');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>00${Math.floor(Math.random() * 100)}</td>
            <td>${nombre} ${apellidos}</td>
            <td>${email}</td>
            <td><span class="badge bg-${rol === 'admin' ? 'danger' : 'success'}">${rol === 'admin' ? 'Admin' : 'Cliente'}</span></td>
            <td><span class="badge bg-success">Activo</span></td>
            <td>
                <button class="btn btn-sm btn-outline-dark"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
            </td>
        `;
        tablaUsuarios.prepend(newRow);
    }
    
    // Mostrar modal de nuevo producto
    function abrirModalNuevoProducto() {
        const modalNuevoProducto = new bootstrap.Modal(document.getElementById('modalNuevoProducto'));
        modalNuevoProducto.show();
    }
    
    // Guardar nuevo producto
    function guardarNuevoProducto() {
        const nombre = document.getElementById('productoNombre').value;
        const categoria = document.getElementById('productoCategoria').value;
        const precio = document.getElementById('productoPrecio').value;
        const stock = document.getElementById('productoStock').value;
        
        if (!nombre || !precio || !stock) {
            alert('Por favor, completa todos los campos obligatorios.');
            return;
        }
        
        // Simular guardado
        alert(`Producto ${nombre} añadido correctamente.`);
        
        // Cerrar modal
        bootstrap.Modal.getInstance(document.getElementById('modalNuevoProducto')).hide();
        
        // Añadir a la tabla (simulación)
        const tablaProductos = document.getElementById('tabla-productos');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>P${Math.floor(Math.random() * 1000)}</td>
            <td>${nombre}</td>
            <td>${categoria}</td>
            <td>$${precio}</td>
            <td><span class="badge bg-${stock > 10 ? 'success' : (stock > 5 ? 'warning' : 'danger')}">${stock}</span></td>
            <td>
                <button class="btn btn-sm btn-outline-dark"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
            </td>
        `;
        tablaProductos.prepend(newRow);
    }
    
    // Mostrar modal de nuevo minimarket
    function abrirModalNuevoMinimarket() {
        const modalNuevoMinimarket = new bootstrap.Modal(document.getElementById('modalNuevoMinimarket'));
        modalNuevoMinimarket.show();
    }
    
    // Guardar nuevo minimarket
    function guardarNuevoMinimarket() {
        const nombre = document.getElementById('minimarketNombre').value;
        const direccion = document.getElementById('minimarketDireccion').value;
        const comuna = document.getElementById('minimarketComuna').value;
        const lat = document.getElementById('minimarketLat').value;
        const lng = document.getElementById('minimarketLng').value;
        const horario = document.getElementById('minimarketHorario').value;
        
        if (!nombre || !direccion || !comuna || !lat || !lng || !horario) {
            alert('Por favor, completa todos los campos obligatorios.');
            return;
        }
        
        // Simular guardado
        alert(`Minimarket ${nombre} añadido correctamente.`);
        
        // Cerrar modal
        bootstrap.Modal.getInstance(document.getElementById('modalNuevoMinimarket')).hide();
        
        // Añadir a la tabla (simulación)
        const tablaMinimarkets = document.getElementById('tabla-minimarkets');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>M${Math.floor(Math.random() * 1000)}</td>
            <td>${nombre}</td>
            <td>${direccion}</td>
            <td>${comuna}</td>
            <td><span class="badge bg-success">Activo</span></td>
            <td>
                <button class="btn btn-sm btn-outline-dark"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
            </td>
        `;
        tablaMinimarkets.prepend(newRow);
    }
    
    // Funciones para editar/eliminar elementos
    function editarUsuario(id) {
        alert(`Editar usuario ID: ${id} - Función en desarrollo`);
    }
    
    function eliminarUsuario(id) {
        if (confirm(`¿Estás seguro de que deseas eliminar el usuario con ID ${id}?`)) {
            alert(`Usuario ID ${id} eliminado correctamente`);
            // Simular eliminación de la fila
            document.querySelector(`#tabla-usuarios tr:has(td:contains('${id}'))`).remove();
        }
    }
    
    function editarProducto(id) {
        alert(`Editar producto ID: ${id} - Función en desarrollo`);
    }
    
    function eliminarProducto(id) {
        if (confirm(`¿Estás seguro de que deseas eliminar el producto con ID ${id}?`)) {
            alert(`Producto ID ${id} eliminado correctamente`);
            // Recargar la página para reflejar el cambio
            location.reload();
        }
    }
    
    function editarMinimarket(id) {
        alert(`Editar minimarket ID: ${id} - Función en desarrollo`);
    }
    
    function eliminarMinimarket(id) {
        if (confirm(`¿Estás seguro de que deseas eliminar el minimarket con ID ${id}?`)) {
            alert(`Minimarket ID ${id} eliminado correctamente`);
            // Recargar la página para reflejar el cambio
            location.reload();
        }
    }
    </script>
</body>
</html>