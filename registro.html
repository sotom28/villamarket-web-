<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Villa Markets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="img/logo.png" type="image/png">
    <style>
        .text-green {
            color: #2d8f3c;
        }
        .bg-green {
            background-color: #2d8f3c;
            color: white;
        }
        .btn-green {
            background-color: #2d8f3c;
            color: white;
        }
        .btn-green:hover {
            background-color: #1a5e24;
            color: white;
        }
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100 bg-light">
    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
        <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="home.html">
            <img src="img/logo.png" alt="Villa Markets" width="40" height="40" class="rounded">
            Villa Markets
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="nav" class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="home.html">Inicio</a></li>
            <li class="nav-item"><a class="nav-link" href="minimarkets.html">Minimarkets</a></li>
            <li class="nav-item"><a class="nav-link" href="productos.html">Catálogo</a></li>
            <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
            <li class="nav-item"><a class="nav-link active" href="registro.html">Registrarse</a></li>
            </ul>
        </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container py-5">
        <div class="form-container">
            <h1 class="text-center text-green mb-4">Crear una cuenta</h1>
            <p class="text-center text-muted mb-4">Completa el formulario para registrarte en Villa Markets</p>

            <form id="registroForm" onsubmit="registrarUsuario(event)">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="apellidos" class="form-label">Apellidos</label>
                        <input type="text" class="form-control" id="apellidos" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="rut" class="form-label">RUT</label>
                    <input type="text" class="form-control" id="rut" placeholder="12.345.678-9" required>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="correo" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="correo" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="confirmarCorreo" class="form-label">Confirmar Correo</label>
                        <input type="email" class="form-control" id="confirmarCorreo" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="direccion" class="form-label">Dirección</label>
                    <input type="text" class="form-control" id="direccion" required>
                </div>

                <div class="mb-3">
                    <label for="telefono" class="form-label">Número de Celular</label>
                    <input type="tel" class="form-control" id="telefono" placeholder="+56912345678" required>
                </div>

                <div class="mb-3">
                    <label for="dieta" class="form-label">Tipo de Dieta</label>
                    <select class="form-select" id="dieta">
                        <option value="Ninguna" selected>Ninguna</option>
                        <option value="Vegana">Vegana</option>
                        <option value="Vegetariana">Vegetariana</option>
                        <option value="Sin gluten">Sin gluten</option>
                        <option value="Keto">Keto</option>
                        <option value="Otra">Otra</option>
                    </select>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="confirmarPassword" class="form-label">Confirmar Contraseña</label>
                        <input type="password" class="form-control" id="confirmarPassword" required>
                    </div>
                </div>

                <div class="mb-4 form-check">
                    <input type="checkbox" class="form-check-input" id="terminos" required>
                    <label class="form-check-label" for="terminos">Acepto los <a href="#">Términos y Condiciones</a></label>
                </div>

                <button type="submit" class="btn btn-green btn-lg w-100">Registrarse</button>
            </form>

            <div class="text-center mt-3">
                <p>¿Ya tienes una cuenta? <a href="login.html" class="text-green">Inicia sesión aquí</a></p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Villa Markets</h5>
                    <p>Tu plataforma para mini markets locales en todo Chile.</p>
                </div>
                <div class="col-md-4">
                    <h5>Enlaces rápidos</h5>
                    <ul class="list-unstyled">
                        <li><a href="minimarkets.html" class="text-white">Minimarkets</a></li>
                        <li><a href="productos.html" class="text-white">Catálogo</a></li>
                        <li><a href="soporte.html" class="text-white">Soporte</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contáctanos</h5>
                    <p>contacto@villamarkets.cl</p>
                    <p>+56 9 1234 5678</p>
                </div>
            </div>
            <hr>
            <p class="text-center small mb-0">© 2025 Villa Markets. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Incluir iconos de Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script>
        function validarRut(rut) {
            // Eliminar puntos y guión del RUT
            rut = rut.replace(/\./g, '').replace(/-/g, '');
            
            // Extraer el dígito verificador
            const dv = rut.slice(-1).toUpperCase();
            const rutSinDV = rut.slice(0, -1);
            
            // Verificar que el RUT es numérico y el DV puede ser número o K
            if (!/^\d+$/.test(rutSinDV) || !/^[\dK]$/.test(dv)) {
                return false;
            }
            
            // Calcular el dígito verificador esperado
            let suma = 0;
            let multiplicador = 2;
            
            // Recorrer el RUT de derecha a izquierda
            for (let i = rutSinDV.length - 1; i >= 0; i--) {
                suma += parseInt(rutSinDV[i]) * multiplicador;
                multiplicador = multiplicador < 7 ? multiplicador + 1 : 2;
            }
            
            const dvEsperado = 11 - (suma % 11);
            const dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();
            
            // Verificar que el DV calculado es igual al DV ingresado
            return dvCalculado === dv;
        }
        
        function formatearRut(rut) {
            // Eliminar puntos y guión
            rut = rut.replace(/\./g, '').replace(/-/g, '');
            
            // Separar el cuerpo y el dígito verificador
            const dv = rut.slice(-1);
            const rutSinDV = rut.slice(0, -1);
            
            // Formatear el cuerpo del RUT con puntos
            let rutFormateado = '';
            for (let i = rutSinDV.length; i > 0; i -= 3) {
                const inicio = Math.max(0, i - 3);
                rutFormateado = (i < rutSinDV.length ? '.' : '') + rutSinDV.substring(inicio, i) + rutFormateado;
            }
            
            // Devolver el RUT formateado
            return rutFormateado + '-' + dv;
        }
        
        // Validar RUT mientras se escribe
        document.addEventListener('DOMContentLoaded', function() {
            const rutInput = document.getElementById('rut');
            
            if (rutInput) {
                rutInput.addEventListener('blur', function() {
                    const rutIngresado = this.value;
                    
                    if (rutIngresado.trim() !== '') {
                        if (validarRut(rutIngresado)) {
                            this.value = formatearRut(rutIngresado);
                            this.classList.remove('is-invalid');
                            this.classList.add('is-valid');
                        } else {
                            this.classList.remove('is-valid');
                            this.classList.add('is-invalid');
                            
                            // Mostrar mensaje de error
                            let feedbackElement = this.nextElementSibling;
                            if (!feedbackElement || !feedbackElement.classList.contains('invalid-feedback')) {
                                feedbackElement = document.createElement('div');
                                feedbackElement.className = 'invalid-feedback';
                                this.parentNode.appendChild(feedbackElement);
                            }
                            feedbackElement.textContent = 'RUT inválido. Verifique el formato y dígito verificador.';
                        }
                    }
                });
            }
        });

        function registrarUsuario(event) {
            event.preventDefault();
            
            // Validar que los correos coincidan
            if (document.getElementById('correo').value !== document.getElementById('confirmarCorreo').value) {
                alert('Los correos electrónicos no coinciden. Por favor, verifica ambos campos.');
                return;
            }
            
            // Validar que las contraseñas coincidan
            if (document.getElementById('password').value !== document.getElementById('confirmarPassword').value) {
                alert('Las contraseñas no coinciden. Por favor, verifica ambos campos.');
                return;
            }
            
            // Validar RUT
            const rutIngresado = document.getElementById('rut').value;
            if (!validarRut(rutIngresado)) {
                alert('El RUT ingresado no es válido. Por favor, verifica el formato y el dígito verificador.');
                return;
            }
            
            // Validar contraseña segura
            const password = document.getElementById('password').value;
            if (password.length < 8) {
                alert('La contraseña debe tener al menos 8 caracteres.');
                return;
            }
            
            // Simular registro exitoso (en un caso real esto iría a un servidor)
            const nuevoUsuario = {
                nombre: document.getElementById('nombre').value,
                apellidos: document.getElementById('apellidos').value,
                rut: document.getElementById('rut').value,
                email: document.getElementById('correo').value, // Cambiado a 'email' para ser consistente con menuprincipal.html
                direccion: document.getElementById('direccion').value,
                telefono: document.getElementById('telefono').value,
                dieta: document.getElementById('dieta').value,
                password: document.getElementById('password').value, // Incluir la contraseña para poder iniciar sesión
                rol: 'cliente'
            };
            
            // Guardar en localStorage (solo como simulación)
            localStorage.setItem('usuarioActual', JSON.stringify(nuevoUsuario)); // Cambiado a 'usuarioActual' para ser consistente
            
            // Crear un registro de usuarios si no existe
            let usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
            usuarios.push(nuevoUsuario);
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            
            // Mensaje de éxito más descriptivo
            Swal.fire({
                icon: 'success',
                title: '¡Registro exitoso!',
                text: 'Bienvenido a Villa Markets. Tu cuenta ha sido creada correctamente.',
                confirmButtonColor: '#2d8f3c'
            }).then(() => {
                // Redirigir a la página principal
                window.location.href = 'menuprincipal.html';
            });
        }
    </script>
    
    <!-- SweetAlert2 para mensajes más atractivos -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
